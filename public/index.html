<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS | Anonymous</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        :root {
            --cyan: #00ffff;
            --mint: #98ff98;
            --seafoam: #93e9be;
            --dark-cyan: #008b8b;
            --dark-mint: #3d6b4d;
            --bg-dark: #0a0a0a;
            --nexus-gradient: linear-gradient(to bottom, var(--cyan), var(--mint));
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: black;
            font-family: 'Roboto Mono', monospace;
            font-weight: 400;
            color: white;
            overflow: hidden;
        }

        /* --- SCREENS --- */
        .screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s ease;
            z-index: 10;
        }

        .hidden { display: none; opacity: 0; }

        /* --- INTRO LOGO --- */
        #intro-logo {
            background: black;
            z-index: 100;
        }

        .logo-text {
            font-size: 3.5rem;
            background: var(--nexus-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px var(--cyan));
            animation: logoFadeIn 1.5s forwards, pulse 2s infinite ease-in-out 1.5s;
            opacity: 0;
        }

        @keyframes logoFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse {
            0%, 100% { filter: drop-shadow(0 0 15px var(--cyan)); }
            50% { filter: drop-shadow(0 0 30px var(--mint)); transform: scale(1.02); }
        }

        /* --- TUTORIAL & CUSTOMIZATION --- */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 15px;
            max-width: 500px;
            text-align: center;
        }

        button {
            background: var(--nexus-gradient);
            border: none; padding: 10px 20px;
            font-family: 'Roboto Mono';
            cursor: pointer; font-weight: bold;
            margin-top: 20px; border-radius: 5px;
        }

        .color-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .color-opt { width: 30px; height: 30px; cursor: pointer; border: 2px solid transparent; border-radius: 50%; }
        .color-opt:hover { border-color: white; }

        /* --- CHAT INTERFACE --- */
        #main-chat {
            display: flex; flex-direction: column;
            background: var(--bg-dark);
        }

        #top-bar {
            width: 100%; height: 60px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; border-bottom: 1px solid var(--glass);
        }

        #chat-flow {
            flex: 1; overflow-y: auto; padding: 20px;
            display: flex; flex-direction: column; gap: 15px;
        }

        .message {
            max-width: 70%; padding: 10px 15px;
            border-radius: 10px; position: relative;
        }

        .my-msg { align-self: flex-end; background: rgba(0, 255, 255, 0.1); border-right: 3px solid var(--cyan); }
        .their-msg { align-self: flex-start; background: rgba(255, 255, 255, 0.05); border-left: 3px solid #ccc; }

        /* --- INPUT AREA --- */
        #input-area {
            padding: 20px; background: rgba(0,0,0,0.5);
            display: flex; align-items: center; gap: 10px;
        }

        #text-bar {
            flex: 1; background: var(--glass); border: 1px solid var(--glass);
            color: white; padding: 12px; font-family: 'Roboto Mono';
            outline: none; border-radius: 5px;
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { box-shadow: 0 0 0px var(--cyan); }
            50% { box-shadow: 0 0 8px var(--cyan); }
            100% { box-shadow: 0 0 0px var(--cyan); }
        }

        /* --- THEMES --- */
        .theme-firestone { background: radial-gradient(circle, #4a0000, #000); }
        .theme-seashine { background: linear-gradient(180deg, #002b2b, #004d4d); }
    </style>
</head>
<body>

    <div id="intro-logo" class="screen">
        <div class="logo-text">&lt;NEXUS&gt;</div>
    </div>

    <div id="tut-screen" class="screen hidden">
        <div class="glass-panel">
            <h2 style="color: var(--cyan)">Tutorial to NEXUS</h2>
            <p>NEXUS is a Global chatting service with anonymous protections and data wiping to secure you. Nothing saves.</p>
            <div id="online-prompt" class="hidden">
                <p style="color: var(--seafoam)">No one else is online, copy link to share?</p>
                <code id="link-box" style="font-size: 0.8rem;">nexus-chat.render.com</code>
            </div>
            <button onclick="showStep(2)">NEXT</button>
        </div>
    </div>

    <div id="profile-screen" class="screen hidden">
        <div class="glass-panel">
            <h2>CUSTOMIZE PROFILE</h2>
            <input type="text" id="username" placeholder="Username..." maxlength="15" style="width:80%; padding:10px; margin-bottom:10px;">
            
            <p>Pick Username Color (Gradients)</p>
            <div class="color-grid">
                <div class="color-opt" style="background: linear-gradient(#ff0000, #4a0000)" onclick="setColor('red')"></div>
                <div class="color-opt" style="background: linear-gradient(#00ffff, #008b8b)" onclick="setColor('cyan')"></div>
                <div class="color-opt" style="background: linear-gradient(#98ff98, #3d6b4d)" onclick="setColor('mint')"></div>
                <div class="color-opt" style="background: linear-gradient(#ff00ff, #4a004a)" onclick="setColor('pink')"></div>
            </div>

            <p>Choose Theme</p>
            <select id="theme-select" style="width: 80%; padding: 10px;">
                <option value="default">Default (Night Sky)</option>
                <option value="firestone">FireStone (Lava)</option>
                <option value="seashine">SeaShine (Ocean)</option>
            </select>

            <button onclick="finishProfile()">READY TO CHAT?</button>
        </div>
    </div>

    <div id="main-chat" class="screen hidden">
        <div id="top-bar">
            <div class="logo-text" style="font-size: 1.2rem;">&lt;NEXUS&gt;</div>
            <div id="status-indicator" style="color: var(--mint)">‚óè Connected</div>
            <div>Users: <span id="user-count">1</span></div>
        </div>

        <div id="chat-flow">
            </div>

        <div id="typing-indicator" style="padding-left: 20px; font-size: 0.8rem; color: var(--seafoam); height: 20px;"></div>
        
        <div id="input-area">
            <button style="margin:0; width: 40px;">+</button>
            <input type="text" id="text-bar" placeholder="Type a message...">
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myProfile = { name: '', color: '', theme: '' };

        // 1. Intro Logic
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('intro-logo').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('intro-logo').classList.add('hidden');
                    document.getElementById('tut-screen').classList.remove('hidden');
                }, 800);
            }, 3500);
        };

        function showStep(step) {
            document.getElementById('tut-screen').classList.add('hidden');
            document.getElementById('profile-screen').classList.remove('hidden');
        }

        function setColor(c) { myProfile.color = c; }

        function finishProfile() {
            myProfile.name = document.getElementById('username').value || "Anon";
            myProfile.theme = document.getElementById('theme-select').value;
            
            document.body.className = 'theme-' + myProfile.theme;
            document.getElementById('profile-screen').classList.add('hidden');
            document.getElementById('main-chat').classList.remove('hidden');
        }

        // 2. Messaging Logic
        const textBar = document.getElementById('text-bar');
        const chatFlow = document.getElementById('chat-flow');

        textBar.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && textBar.value.trim() !== "") {
                const msgData = {
                    user: myProfile.name,
                    color: myProfile.color,
                    text: textBar.value
                };
                socket.emit('send_message', msgData);
                appendMessage(msgData, true);
                textBar.value = "";
            }
        });

        function appendMessage(data, isMe) {
            const div = document.createElement('div');
            div.className = `message ${isMe ? 'my-msg' : 'their-msg'}`;
            div.innerHTML = `
                <div style="font-size: 0.7rem; font-weight: bold;">${data.user}</div>
                <div>${data.text}</div>
            `;
            chatFlow.appendChild(div);
            chatFlow.scrollTop = chatFlow.scrollHeight;
        }

        socket.on('receive_message', (data) => {
            if(data.user !== myProfile.name) {
                appendMessage(data, false);
            }
        });

        socket.on('data_wipe', () => {
            location.reload(); // Force refresh to clear all local variables
        });
    </script>
</body>
</html>
